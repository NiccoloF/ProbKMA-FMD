\doxysection{Motif.\+ipp}
\hypertarget{_motif_8ipp_source}{}\label{_motif_8ipp_source}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00001}00001\ \textcolor{preprocessor}{\#ifndef\ \_\_MOTIF\_IPP\_\_}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00002}00002\ \textcolor{preprocessor}{\#define\ \_\_MOTIF\_IPP\_\_}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ "{}Motif.hpp"{}}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00005}00005\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ use1>}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00006}00006\ std::variant<MotifPure::indexField,KMA::Mfield>}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00007}00007\ \mbox{\hyperlink{class_motif_sobol_a47e5ba76b22f0b022a82f44b399d25ce}{MotifSobol::compute\_motif\_helper}}(\textcolor{keyword}{const}\ arma::urowvec\&\ v\_dom,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00008}00008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ KMA::ivector\&\ s\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00009}00009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ KMA::vector\&\ p\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00010}00010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ KMA::Mfield\&\ Y,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00011}00011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ m)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00012}00012\ \textcolor{keyword}{}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00013}00013\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00014}00014\ \ \ \textcolor{keywordflow}{if}(arma::accu(p\_k)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00015}00015\ \ \ \ \ \ \ Rcpp::stop(\textcolor{stringliteral}{"{}Motif\ with\ no\ members!\ Degenerate\ cluster!"{}});}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00016}00016\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00018}00018\ \ \ arma::uword\ v\_len\ =\ v\_dom.n\_elem;\ \textcolor{comment}{//length\ of\ the\ current\ domain}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00020}00020\ \ \ arma::uword\ d\ =\ Y(0,0).n\_cols;\ \textcolor{comment}{//number\ of\ cols\ of\ the\ curves}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00022}00022\ \ \ KMA::uvector\ p\_k\_pos\ =\ arma::find(p\_k\ >\ 0);\ \textcolor{comment}{//we\ will\ consider\ only\ the\ curves\ assigned\ to\ motif\ k}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00024}00024\ \ \ KMA::Mfield\ Y\_inters\_k(p\_k\_pos.n\_elem,Y.n\_cols);\ \textcolor{comment}{//list\ of\ shifted\ curves}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00026}00026\ \ \ KMA::umatrix\ Y\_inters\_supp(p\_k\_pos.n\_elem,v\_len);\ \textcolor{comment}{//\ for\ each\ shifted\ curve\ contains\ an\ uvec\ with\ the\ domain}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00028}00028\ \ \ KMA::uvector\ filtered\_j;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00029}00029\ \ \ KMA::ivector\ index;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00030}00030\ \ \ KMA::uvector\ indeces\_dom\ =\ arma::find(v\_dom==0);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00031}00031\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ y\_len;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00033}00033\ \ \ \textcolor{keywordflow}{for}\ (arma::uword\ i\ =\ 0;\ i\ <\ p\_k\_pos.n\_elem;\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00034}00034\ \ \ \ \ y\_len\ =\ Y(p\_k\_pos(i),0).n\_rows;\ \textcolor{comment}{//length\ of\ the\ curve}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00035}00035\ \ \ \ \ index\ =\ std::max(1,s\_k(p\_k\_pos(i)))\ -\/\ 1\ +\ arma::regspace<KMA::ivector>(1,v\_len\ -\/\ std::max(0,1\ -\/\ s\_k(p\_k\_pos(i))));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00036}00036\ \ \ \ \ filtered\_j\ =\ arma::find(index\ <=\ y\_len);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00037}00037\ \ \ \ \ Y\_inters\_k(i,0).set\_size(v\_len,d);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00038}00038\ \ \ \ \ Y\_inters\_k(i,0).fill(arma::datum::nan);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00039}00039\ \ \ \ \ Y\_inters\_k(i,0).rows(std::max(0,1\ -\/\ s\_k(p\_k\_pos(i))),std::max(0,1\ -\/\ s\_k(p\_k\_pos(i)))\ +\ filtered\_j.n\_elem\ -\/\ 1)\ =\ \ Y(p\_k\_pos(i),0).rows(index(*(filtered\_j.cbegin()))\ -\/\ 1,\ index(*(filtered\_j.cend()\ -\/\ 1))\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00040}00040\ \ \ \ \ Y\_inters\_k(i,0).shed\_rows(indeces\_dom);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00041}00041\ \ \ \ \ Y\_inters\_supp.row(i)\ =\ util::findDomain(Y\_inters\_k(i,0));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00042}00042\ \ \ \ \ Y\_inters\_k(i,0).replace(arma::datum::nan,0);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00043}00043\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(use1)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00044}00044\ \ \ \ \ \ \ Y\_inters\_k(i,1).set\_size(v\_len,d);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00045}00045\ \ \ \ \ \ \ Y\_inters\_k(i,1).fill(arma::datum::nan);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00046}00046\ \ \ \ \ \ \ Y\_inters\_k(i,1).rows(std::max(0,1\ -\/\ s\_k(p\_k\_pos(i))),std::max(0,1\ -\/\ s\_k(p\_k\_pos(i)))\ +\ filtered\_j.n\_elem\ -\/\ 1)\ =\ \ Y(p\_k\_pos(i),1).rows(index(*(filtered\_j.cbegin()))\ -\/\ 1,\ index(*(filtered\_j.cend()\ -\/\ 1))\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00047}00047\ \ \ \ \ \ \ Y\_inters\_k(i,1).shed\_rows(indeces\_dom);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00048}00048\ \ \ \ \ \ \ Y\_inters\_k(i,1).replace(arma::datum::nan,0);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00049}00049\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00050}00050\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00052}00052\ \ \ KMA::Mfield\ v\_new(1,Y.n\_cols);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00054}00054\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (use1)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00055}00055\ \ \ \ \ v\_new(0,1)\ =\ \mbox{\hyperlink{class_motif_sobol_a043c48ee6f9c37adae32680d66ee0f14}{compute\_v\_new}}(Y\_inters\_k.col(1),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y\_inters\_supp,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v\_dom,v\_len,p\_k,d,m);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00059}00059\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00061}00061\ \ \ v\_new(0,0)\ =\ \mbox{\hyperlink{class_motif_sobol_a043c48ee6f9c37adae32680d66ee0f14}{compute\_v\_new}}(Y\_inters\_k.col(0),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y\_inters\_supp,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v\_dom,v\_len,p\_k,d,m);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00066}00066\ \ \ KMA::uvector\ v\_new\_domain\ =\ arma::find(util::findDomain<KMA::matrix>(v\_new(0,0))\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00067}00067\ \ \ arma::sword\ index\_min\ =\ v\_new\_domain.min();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00068}00068\ \ \ arma::sword\ index\_max\ =\ v\_new\_domain.max();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00070}00070\ \ \ v\_new(0,0)\ =\ v\_new(0,0).rows(index\_min,index\_max);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00071}00071\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00072}00072\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (use1)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00073}00073\ \ \ \ \ \ \ v\_new(0,1)\ =\ v\_new(0,1).rows(index\_min,index\_max);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00074}00074\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00075}00075\ \ \ \textcolor{keywordflow}{if}\ (index\_min\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00076}00076\ \ \ \ \ Rcpp::Rcout<<\textcolor{stringliteral}{"{}ATTENZIONE\ NO\ TESTATO\ MOTIF.IPP\ 78"{}}<<std::endl;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00077}00077\ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_pair(v\_new,index\_min);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00078}00078\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00080}00080\ \ \ \textcolor{keywordflow}{return}\ v\_new;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00081}00081\ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00083}00083\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ use1>}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00084}\mbox{\hyperlink{class_motif_sobol_adcda5b364bd6b60462c42388d699333e}{00084}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_motif_sobol_adcda5b364bd6b60462c42388d699333e}{MotifSobol::elongation}}(KMA::Mfield\&\ V\_new,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<arma::urowvec>\ \&\ V\_dom,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KMA::imatrix\&\ S\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ arma::vec\ \&\ p\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ arma::ivec\&\ len\_elong\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ arma::uvec\&\ keep\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ c,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ KMA::Mfield\ Y,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_parameters}{Parameters}}\&\ param,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<PerformanceIndexAB>\&\ perf,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<Dissimilarity>\&\ diss)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00096}00096\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00097}00097\ \ \ \textcolor{keywordflow}{if}(len\_elong\_k.empty())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00099}00099\ \ \ \textcolor{keyword}{const}\ KMA::Mfield\&\ v\_new\_k\ =\ V\_new.row(index);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00100}00100\ \ \ \textcolor{keyword}{const}\ arma::urowvec\&\ v\_dom\_k\ =\ V\_dom[index];}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00101}00101\ \ \ \textcolor{keyword}{const}\ arma::ivec\&\ s\_k\ =\ S\_k.col(index);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00103}00103\ \ \ \textcolor{comment}{//\ new\ vec\ with\ zero\ at\ the\ top}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00104}00104\ \ \ arma::ivec\ len\_elong\_k\_zero(len\_elong\_k.size()\ +\ 1,\ arma::fill::zeros);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00105}00105\ \ \ std::copy(len\_elong\_k.begin(),\ len\_elong\_k.end(),\ len\_elong\_k\_zero.begin()\ +\ 1);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00107}00107\ \ \ \textcolor{comment}{//\ create\ a\ matrix\ whose\ column\_i\ contains\ the\ vector\ s\_k\ -\/\ len\_elong\_k\_zero[i]}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00108}00108\ \ \ arma::uword\ len\_elong\_k\_zero\_size\ =\ len\_elong\_k\_zero.size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00109}00109\ \ \ arma::imat\ s\_k\_elong\_left\_right\_temp(s\_k.n\_elem,\ len\_elong\_k\_zero\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00111}00111\ \ \ \textcolor{keywordflow}{for}\ (arma::uword\ i=0;\ i\ <\ len\_elong\_k\_zero\_size;++i)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00112}00112\ \ \ \ \ s\_k\_elong\_left\_right\_temp.col(i)\ =\ s\_k\ -\/\ len\_elong\_k\_zero(i);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00113}00113\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00115}00115\ \ \ \textcolor{comment}{//\ create\ a\ sequence\ of\ integer\ from\ len\_elong\_k\_zero.size()\ to\ 1}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00116}00116\ \ \ arma::ivec\ reversedSequence\ =\ arma::regspace<arma::ivec>(len\_elong\_k\_zero\_size,-\/1,1);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00117}00117\ \ \ reversedSequence(0)\ -\/=\ 1;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00119}00119\ \ \ \textcolor{comment}{//\ repeat\ each\ col\ of\ s\_k\_elong\_left\_right\ a\ number\ of\ times\ specified\ by\ reversedSequence}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00120}00120\ \ \ std::vector<arma::ivec>\ s\_k\_elong\_left\_right\ =\ util::repeat\_elements(s\_k\_elong\_left\_right\_temp,\ reversedSequence);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00121}00121\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00122}00122\ \ \ std::vector<arma::ivec>\ len\_elong\_k\_right\_list(len\_elong\_k\_zero\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00123}00123\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ max\_len\_elong\_k\ =\ len\_elong\_k.back();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00124}00124\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ v\_dom\_elong\_size\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00126}00126\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ len\_elong\_k\_zero\_size;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00127}00127\ \ \ \ \ len\_elong\_k\_right\_list[i]\ =\ len\_elong\_k\_zero.elem(find(len\_elong\_k\_zero\ <=\ \ max\_len\_elong\_k\ -\/\ len\_elong\_k\_zero(i)));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00128}00128\ \ \ \ \ v\_dom\_elong\_size\ +=\ len\_elong\_k\_right\_list[i].size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00129}00129\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00131}00131\ \ \ \textcolor{comment}{//\ \ v\_dom\_elong\_left\_right\ will\ be\ a\ vector\ of\ arma::uvec\ containing\ all\ the\ elongated\ version\ of\ v\_dom\_k}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00132}00132\ \ \ std::vector<arma::urowvec>\ v\_dom\_elong\_left\_right(v\_dom\_elong\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00133}00133\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ v\_dom\_k\_len\ =\ v\_dom\_k.n\_elem;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00134}00134\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ k\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00135}00135\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ len\_elong\_k\_zero\_size;\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00136}00136\ \ \ \ \ \textcolor{keyword}{const}\ arma::ivec\ \&\ leng\_elong\_right\_vector\ =\ len\_elong\_k\_right\_list[i];}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00137}00137\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ leng\_elong\_left\ =\ len\_elong\_k\_zero(i);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00138}00138\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ \ leng\_elong\_right\_vector.size();\ ++j)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00139}00139\ \ \ \ \ \ \ arma::urowvec\ temp(leng\_elong\_left\ +\ v\_dom\_k\_len\ +\ leng\_elong\_right\_vector(j),\ arma::fill::ones);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00140}00140\ \ \ \ \ \ \ temp.cols(leng\_elong\_left,\ leng\_elong\_left\ +\ v\_dom\_k.n\_elem\ -\/\ 1)\ =\ v\_dom\_k;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00141}00141\ \ \ \ \ \ \ v\_dom\_elong\_left\_right[k++]\ =\ temp;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00142}00142\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00143}00143\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00145}00145\ \ \ \textcolor{comment}{//\ create\ the\ list\ containing\ all\ the\ possible\ v\_dom\_k\ elongated\ using\ compute\_motif}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00146}00146\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ v\_elong\_left\_right\_size\ =\ s\_k\_elong\_left\_right.size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00147}00147\ \ \ arma::uvec\ not\_start\_with\_NA(v\_elong\_left\_right\_size,arma::fill::zeros);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00148}00148\ \ \ KMA::Mfield\ v\_elong\_left\_right(v\_elong\_left\_right\_size,Y.n\_cols);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00151}00151\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ v\_elong\_left\_right\_size;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00152}00152\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&\ pair\_motif\_shift\ =\ compute\_motif\_helper<use1>(v\_dom\_elong\_left\_right[i+1],\ s\_k\_elong\_left\_right[i],\ p\_k,\ Y,\ param.\mbox{\hyperlink{struct_parameters_afaef9f203aaca558b6af72da3a3408b1}{\_m}});}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00153}00153\ \ \ \ \ \textcolor{keywordflow}{if}\ (std::holds\_alternative<KMA::Mfield>(pair\_motif\_shift))\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00154}00154\ \ \ \ \ \ \ v\_elong\_left\_right.row(i)\ =\ *(std::get\_if<KMA::Mfield>(\&pair\_motif\_shift));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00155}00155\ \ \ \ \ \ \ not\_start\_with\_NA(i)\ =\ 1;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00156}00156\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00157}00157\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00159}00159\ \ \ \textcolor{comment}{//\ filter\ centroid\ and\ shifts\ that\ are\ not\ in\ NA\ positions}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00160}00160\ \ \ \textcolor{keyword}{auto}\ not\_NA\_index\ =\ std::views::iota(0,v\_elong\_left\_right\_size)}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00161}00161\ \ \ \ \ |\ std::views::filter([\&not\_start\_with\_NA](\textcolor{keywordtype}{int}\ index\_j)\{\textcolor{keywordflow}{return}(not\_start\_with\_NA(index\_j));\});}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00163}00163\ \ \ KMA::Mfield\ filtered\_v\_elong(arma::accu(not\_start\_with\_NA),Y.n\_cols);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00164}00164\ \ \ std::vector<arma::ivec>\ filtered\_s\_k(arma::accu(not\_start\_with\_NA));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00166}00166\ \ \ \textcolor{keywordtype}{int}\ i\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00167}00167\ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&\ index\ :\ not\_NA\_index)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00168}00168\ \ \ \ \ filtered\_v\_elong.row(i)\ =\ v\_elong\_left\_right.row(index);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00169}00169\ \ \ \ \ filtered\_s\_k[i]\ =\ s\_k\_elong\_left\_right[index];}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00170}00170\ \ \ \ \ i\ =\ i\ +\ 1;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00171}00171\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00173}00173\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ s\_k\_elong\_left\_right\_size\ =\ filtered\_s\_k.size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00174}00174\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00175}00175\ \ \ \textcolor{comment}{//\ compute\ performance\ index\ before\ elongation}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00176}00176\ \ \ \textcolor{keywordtype}{double}\ Jk\_before\ =\ perf-\/>compute\_Jk(v\_new\_k,s\_k,p\_k,Y,param.\mbox{\hyperlink{struct_parameters_adc336c5aa0075666f66e1df0d8b1ea30}{\_w}},param.\mbox{\hyperlink{struct_parameters_afaef9f203aaca558b6af72da3a3408b1}{\_m}},}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ arma::datum::nan,\ KMA::uvector(\{\}),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ diss);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00180}00180\ \ \ \textcolor{comment}{//\ compute\ performance\ indexes\ for\ all\ possible\ elongations}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00181}00181\ \ \ arma::vec\ Jk\_after(s\_k\_elong\_left\_right\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00182}00182\ \ \ \textcolor{keywordtype}{double}\ c\_i;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00183}00183\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00184}00184\ \ \ \textcolor{keywordflow}{for}\ (arma::uword\ i\ =\ 0;\ i\ <\ s\_k\_elong\_left\_right\_size;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00185}00185\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00186}00186\ \ \ \ \ c\_i\ =\ std::max<double>(floor(util::findDomain(filtered\_v\_elong(i,0)).n\_elem*(1\ -\/\ param.\mbox{\hyperlink{struct_parameters_a19d5035c93057c0667152839743775b9}{\_max\_gap}})),c);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00187}00187\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00188}00188\ \ \ \ \ Jk\_after[i]\ =\ perf-\/>compute\_Jk(filtered\_v\_elong.row(i),filtered\_s\_k[i],}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p\_k,Y,param.\mbox{\hyperlink{struct_parameters_adc336c5aa0075666f66e1df0d8b1ea30}{\_w}},param.\mbox{\hyperlink{struct_parameters_afaef9f203aaca558b6af72da3a3408b1}{\_m}},c\_i,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ keep\_k,diss);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00191}00191\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00193}00193\ \ \ \textcolor{comment}{//\ find\ the\ best\ elongation\ in\ terms\ of\ perf.\ index}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00194}00194\ \ \ arma::vec\ diff\_perc\ =\ (Jk\_after-\/Jk\_before)/Jk\_before;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00195}00195\ \ \ arma::uword\ best\_elong\ =\ arma::index\_min(diff\_perc);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00196}00196\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00197}00197\ \ \ \textcolor{comment}{//\ check\ that\ the\ min\ really\ exists}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00198}00198\ \ \ \textcolor{keywordtype}{bool}\ elongate\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00199}00199\ \ \ \textcolor{keywordflow}{if}\ (best\_elong\ <\ diff\_perc.size()\ and\ arma::conv\_to<arma::Col<double>>::from(arma::find\_nan(diff\_perc)).size()\ !=\ diff\_perc.size())}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00200}00200\ \ \ \ \ elongate\ =\ diff\_perc(best\_elong)\ <\ param.\mbox{\hyperlink{struct_parameters_a57e001de12a20725b989d653f5b09bca}{\_deltaJK\_elong}};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00202}00202\ \ \ \textcolor{comment}{//\ evaluate\ if\ elongate\ or\ not}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00203}00203\ \ \ \textcolor{keywordflow}{if}(elongate)\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00204}00204\ \ \ \ \ V\_new.row(index)\ =\ \ filtered\_v\_elong.row(best\_elong);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00205}00205\ \ \ \ \ V\_dom[index]\ =\ \ v\_dom\_elong\_left\_right[best\_elong\ +\ 1];}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00206}00206\ \ \ \ \ S\_k.col(index)\ =\ filtered\_s\_k[best\_elong];\ \textcolor{comment}{//\ stampare\ questo}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00207}00207\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00208}00208\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00209}00209\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00210}00210\ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00211}00211\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00212}00212\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ use1>}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00213}\mbox{\hyperlink{class_motif_sobol_aa48674c336d64b50336317c21b155e24}{00213}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_motif_sobol_aa48674c336d64b50336317c21b155e24}{MotifSobol::elongate\_motifs\_helper}}(KMA::Mfield\&\ V\_new,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<arma::urowvec>\&\ V\_dom,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KMA::imatrix\&\ S\_k,\textcolor{keyword}{const}\ KMA::matrix\&\ P\_k,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ KMA::Mfield\&\ Y,\textcolor{keyword}{const}\ KMA::matrix\&\ D,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00217}00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_parameters}{Parameters}}\&\ param,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<PerformanceIndexAB>\&\ perf,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<Dissimilarity>\&\ diss,}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Rcpp::Function\ \&\ quantile\_func)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00221}00221\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00222}00222\ \textcolor{preprocessor}{\#ifdef\ \_OPENMP}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00223}00223\ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ threads\ }}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00224}00224\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n\_threads\ =\ param.\mbox{\hyperlink{struct_parameters_a7814f00072ab1dbe1e9a7b15cc3a5f29}{\_n\_threads}};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00225}00225\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00227}00227\ \ \ \ \ std::size\_t\ V\_dom\_size\ =\ V\_dom.size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00228}00228\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00229}00229\ \ \ \ \ arma::uvec\ len\_dom(V\_dom\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00230}00230\ \ \ \ \ arma::uvec\ bool\_gaps(V\_dom\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00231}00231\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ V\_dom\_size;\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ len\_dom(i)\ =\ V\_dom[i].size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \ \ \ bool\_gaps(i)\ =\ (arma::accu(V\_dom[i])\ <\ len\_dom(i));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00234}00234\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00236}00236\ \ \ \ \ arma::uvec\ with\_gaps\ =\ arma::find(bool\_gaps\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00237}00237\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ with\_gaps\_size\ =\ with\_gaps.size();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00238}00238\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00239}00239\ \ \ \ \ \textcolor{comment}{//\ @TODO:\ check\ this\ part\ for\ domains\ with\ NaN}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00240}00240\ \ \ \ \ \textcolor{keywordflow}{if}\ (with\_gaps\_size\ !=\ 0)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00242}00242\ \ \ \ \ \ \ \ \ KMA::Mfield\ V\_filled(with\_gaps\_size,Y.n\_cols);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00244}00244\ \ \ \ \ \ \ \ \ std::vector<KMA::uvector>\ V\_dom\_filled(with\_gaps\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ arma::vec\ Jk\_before(with\_gaps\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00248}00248\ \ \ \ \ \ \ arma::vec\ Jk\_after(with\_gaps\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00249}00249\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00250}00250\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ fill\ the\ domains\ of\ the\ motifs\ with\ gaps\ and\ recompute\ the\ motifs\ with\ the\ filled\ domains}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00251}00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ compute\ the\ perf.indexes\ before\ and\ after\ the\ filling}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00252}00252\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#ifdef\ \_OPENMP}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00253}00253\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ for\ num\_threads(n\_threads)}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00254}00254\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00255}00255\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ with\_gaps\_size;\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00256}00256\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00257}00257\ \ \ \ \ \ \ \ \ V\_dom\_filled[i]\ =\ arma::uvec(V\_dom[with\_gaps(i)].n\_elem,arma::fill::ones);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00258}00258\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&\ variant\_motif\ =\ compute\_motif\_helper<use1>(V\_dom\_filled[i],\ \ \textcolor{comment}{//\ errore}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ S\_k.col(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00260}00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ P\_k.col(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y,param.\mbox{\hyperlink{struct_parameters_afaef9f203aaca558b6af72da3a3408b1}{\_m}});}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00262}00262\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00263}00263\ \ \ \ \ \ \ \ \ V\_filled.row(i)\ =\ *(std::get\_if<KMA::Mfield>(\&variant\_motif));\ \textcolor{comment}{//\ Possibile\ errore\ se\ ritorna\ Nullptr}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00264}00264\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00265}00265\ \ \ \ \ \ \ \ \ Jk\_before(i)\ =\ perf-\/>compute\_Jk(V\_new.row(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ S\_k.col(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ P\_k.col(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y,param.\mbox{\hyperlink{struct_parameters_adc336c5aa0075666f66e1df0d8b1ea30}{\_w}},param.\mbox{\hyperlink{struct_parameters_afaef9f203aaca558b6af72da3a3408b1}{\_m}},}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ arma::datum::nan,arma::uvec(\{\}),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00270}00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ diss);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00272}00272\ \ \ \ \ \ \ \ \ Jk\_after(i)\ =\ perf-\/>compute\_Jk(V\_filled.row(i),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00273}00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ S\_k.col(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00274}00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ P\_k.col(with\_gaps(i)),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00275}00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y,param.\mbox{\hyperlink{struct_parameters_adc336c5aa0075666f66e1df0d8b1ea30}{\_w}},param.\mbox{\hyperlink{struct_parameters_afaef9f203aaca558b6af72da3a3408b1}{\_m}},}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ arma::datum::nan,arma::uvec(\{\}),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ diss);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00278}00278\ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00279}00279\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00280}00280\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ filling\ the\ domain\ improves\ the\ perf.\ index\ over\ a\ certain\ threshold\ replace\ the\ domain\ and\ the\ motifs\ with\ the\ filled\ one}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00281}00281\ \ \ \ \ \ \textcolor{keyword}{const}\ arma::uvec\&\ fill\ =\ arma::find((Jk\_after-\/Jk\_before)/Jk\_before\ <\ param.\mbox{\hyperlink{struct_parameters_a57e001de12a20725b989d653f5b09bca}{\_deltaJK\_elong}});}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00282}00282\ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i=0;\ i\ <\ fill.size();\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00283}00283\ \ \ \ \ \ \ \ V\_dom[with\_gaps(i)]\ =\ V\_dom\_filled[i];}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00284}00284\ \ \ \ \ \ \ \ V\_new.row(with\_gaps(i))\ =\ V\_filled.row(i);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00285}00285\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00286}00286\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00287}00287\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00288}00288\ \ \ \ \ std::vector<arma::ivec>\ len\_elong(V\_dom\_size);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00289}00289\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ V\_dom\_size;\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00290}00290\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ len\_max\_elong\_i\ =\ std::min<unsigned\ int>(std::floor(len\_dom[i]*param.\mbox{\hyperlink{struct_parameters_a11460b28f570b871d68876a61ac7b231}{\_max\_elong}}),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00291}00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ param.\mbox{\hyperlink{struct_parameters_a4d4f4bba3d04cb38312cef122977d220}{\_c\_max}}[i]\ -\/\ len\_dom[i]);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00292}00292\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (len\_max\_elong\_i\ ==\ 0)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00293}00293\ \ \ \ \ \ \ \ \ len\_elong[i]\ =\ KMA::ivector\{\};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00294}00294\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00295}00295\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00296}00296\ \ \ \ \ \ \ \ \ len\_elong[i]\ =\ \ (len\_max\_elong\_i\ <=\ param.\mbox{\hyperlink{struct_parameters_a80e2d8c413c1cdc690d46a4f6ca8d459}{\_trials\_elong}})\ ?}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00297}00297\ \ \ \ \ \ \ \ \ arma::regspace<arma::ivec>(1,\ len\_max\_elong\_i):}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00298}00298\ \ \ \ \ \ \ \ \ round(arma::linspace<arma::ivec>(1,\ len\_max\_elong\_i,\ param.\mbox{\hyperlink{struct_parameters_a80e2d8c413c1cdc690d46a4f6ca8d459}{\_trials\_elong}}));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00299}00299\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00300}00300\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00301}00301\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00302}00302\ \ \ \ \ \textcolor{keywordtype}{double}\ quant\ =\ Rcpp::as<double>(quantile\_func(D,0.25));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00303}00303\ \ \ \ \ \textcolor{comment}{//\ keep\ will\ be\ a\ matrix\ whose\ value\ i,j\ will\ be\ D(i,j)\ <\ quantile(0)}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00304}00304\ \ \ \ \ arma::umat\ keep\ =\ D\ <\ quant;}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00305}00305\ \ \ \ \ \textcolor{comment}{//\ col-\/wise\ sum\ of\ the\ matrix\ keep}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00306}00306\ \ \ \ \ \textcolor{keyword}{const}\ arma::uvec\&\ col\_sum\_keep\ =\ (sum(keep,\ 0)).t();}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00307}00307\ \ \ \ \ \textcolor{comment}{//\ vector\ of\ bool\ =\ true\ iff\ col\_sum\_keep[i]==0}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00308}00308\ \ \ \ \ \textcolor{keyword}{const}\ arma::uvec\&\ col\_sum\_keep\_zero\ =\ (col\_sum\_keep==0);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00309}00309\ \ \ \ \ \textcolor{comment}{//\ empty\_k\ stores\ the\ indexes\ of\ the\ col\ that\ have\ col\_sum\_keep\ =\ 0}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00310}00310\ \ \ \ \ \textcolor{keyword}{const}\ arma::uvec\&\ empty\_k\ =\ find(col\_sum\_keep\_zero);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00311}00311\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00312}00312\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ k\ :\ empty\_k)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00313}00313\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ min\_col\_k\_D\ =\ index\_min(D.col(k));}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00314}00314\ \ \ \ \ \ \ keep(min\_col\_k\_D,\ k)\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00315}00315\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00317}00317\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ \_OPENMP}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00318}00318\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ for\ num\_threads(n\_threads)}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00319}00319\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00320}00320\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ V\_dom\_size;\ ++i)\{}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00321}00321\ \ \ \ \ \ \ elongation<use1>(V\_new,V\_dom,S\_k,P\_k.col(i),}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ len\_elong[i],keep.col(i),param.\mbox{\hyperlink{struct_parameters_aae52169a8134bf4c04a7bcecdbbec0b4}{\_c}}[i],}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y,i,param,perf,diss);}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00324}00324\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00325}00325\ \}}
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00326}00326\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00327}00327\ }
\DoxyCodeLine{\Hypertarget{_motif_8ipp_source_l00328}00328\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
